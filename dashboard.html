<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urban Gardening Assistant</title>
    <link rel="stylesheet" href="clean-styles.css">
    <link rel="stylesheet" href="ai/ai-styles.css">
    <link rel="stylesheet" href="floating-chat.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
        import { getStorage } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-storage.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyBxuUuIabTyxNP5I75nrwpzyBhpa9v1qYg",
            authDomain: "urban-garden-afb64.firebaseapp.com",
            projectId: "urban-garden-afb64",
            storageBucket: "urban-garden-afb64.firebasestorage.app",
            messagingSenderId: "551109183538",
            appId: "1:551109183538:web:e05fad7a5acf96b9b7142b"
        };
        
        const app = initializeApp(firebaseConfig);
        window.auth = getAuth(app);
        window.db = getFirestore(app);
        window.storage = getStorage(app);
        
        window.auth.onAuthStateChanged(async (user) => {
            if (!user) {
                window.location.href = 'login.html';
            } else {
                await loadUserProfile(user);
            }
        });
        
        async function loadUserProfile(user) {
            try {
                // Set basic user info immediately
                let displayName = user.email ? user.email.split('@')[0] : 'Garden User';
                
                const profileName = document.getElementById('profileName');
                const profileEmail = document.getElementById('profileEmail');
                if (profileName) profileName.textContent = displayName;
                if (profileEmail) profileEmail.textContent = user.email || 'user@example.com';
                
                // Try to load additional profile data
                try {
                    const { doc, getDoc } = await import('https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js');
                    const docSnap = await getDoc(doc(window.db, 'users', user.uid));
                    
                    if (docSnap.exists()) {
                        const userData = docSnap.data();
                        displayName = userData.displayName || displayName;
                        
                        if (profileName) profileName.textContent = displayName;
                        
                        if (userData.photoURL) {
                            const profileImage = document.getElementById('profileImage');
                            const profilePlaceholder = document.getElementById('profilePlaceholder');
                            if (profileImage && profilePlaceholder) {
                                profileImage.src = userData.photoURL;
                                profileImage.style.display = 'block';
                                profilePlaceholder.style.display = 'none';
                            }
                        }
                    }
                } catch (dbError) {
                    console.log('Database not available, using basic profile info');
                }
                
                // Load dashboard components with error handling
                await Promise.allSettled([
                    loadDashboardStats(user),
                    loadWeather(),
                    loadCareReminders(user),
                    loadGrowthProgress(user),
                    loadAchievements(user)
                ]);
                
                // Load AI features after a short delay
                setTimeout(() => {
                    try {
                        generateDailyTips();
                    } catch (e) { console.log('AI tips not available'); }
                    
                    try {
                        runGardenAnalysis();
                    } catch (e) { console.log('AI analysis not available'); }
                }, 1000);
                
            } catch (error) {
                console.error('Error loading profile:', error);
                // Set fallback profile info
                const profileName = document.getElementById('profileName');
                const profileEmail = document.getElementById('profileEmail');
                if (profileName) profileName.textContent = 'Garden User';
                if (profileEmail) profileEmail.textContent = 'Welcome to your garden!';
            }
        }
        
        async function loadDashboardStats(user) {
            try {
                const { doc, getDoc, collection, query, getDocs } = await import('https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js');
                
                const gardenDoc = await getDoc(doc(window.db, 'gardens', user.uid));
                const plantCount = gardenDoc.exists() ? (gardenDoc.data().plants || []).length : 0;
                
                const journalQuery = query(collection(window.db, 'journal', user.uid, 'entries'));
                const journalSnapshot = await getDocs(journalQuery);
                
                const plantCountEl = document.getElementById('plantCount');
                const taskCountEl = document.getElementById('taskCount');
                const journalCountEl = document.getElementById('journalCount');
                const pointsCountEl = document.getElementById('pointsCount');
                
                if (plantCountEl) plantCountEl.textContent = plantCount;
                if (taskCountEl) taskCountEl.textContent = plantCount * 4;
                if (journalCountEl) journalCountEl.textContent = journalSnapshot.size;
                if (pointsCountEl) pointsCountEl.textContent = (plantCount * 50) + (journalSnapshot.size * 25);
                
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
            }
        }

        async function loadWeather() {
            try {
                console.log('Loading weather data...');
                
                // Always show fallback weather first for immediate display
                showSmartFallbackWeather();
                
                // Check if we have cached location
                const cachedLocation = localStorage.getItem('weatherLocation');
                if (cachedLocation) {
                    const { lat, lon } = JSON.parse(cachedLocation);
                    await fetchWeatherByLocation(lat, lon);
                    return;
                }
                
                // Only ask for location if not cached
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        async (position) => {
                            const lat = position.coords.latitude;
                            const lon = position.coords.longitude;
                            
                            // Cache location for future use
                            localStorage.setItem('weatherLocation', JSON.stringify({ lat, lon }));
                            
                            await fetchWeatherByLocation(lat, lon);
                        },
                        async (error) => {
                            console.log('Location access denied, keeping fallback weather');
                            // Keep the fallback weather that's already displayed
                        },
                        { timeout: 3000 }
                    );
                } else {
                    console.log('Geolocation not supported, using fallback weather');
                }
            } catch (error) {
                console.error('Error loading weather:', error);
                showSmartFallbackWeather();
            }
        }
        
        async function fetchWeatherByLocation(lat, lon) {
            try {
                const apiKey = 'dd4f59496eda40f7ba7124230250810';
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);
                
                const response = await fetch(`https://api.weatherapi.com/v1/current.json?key=${apiKey}&q=${lat},${lon}&aqi=no`, {
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (response.ok) {
                    const data = await response.json();
                    displayWeatherApiData(data);
                } else {
                    console.log('Weather API response not ok:', response.status);
                    // Keep fallback weather that's already displayed
                }
            } catch (error) {
                console.log('Weather API error:', error.message);
                // Keep fallback weather that's already displayed
            }
        }
        
        async function fetchWeatherByCity(city) {
            try {
                const apiKey = 'dd4f59496eda40f7ba7124230250810';
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);
                
                const response = await fetch(`https://api.weatherapi.com/v1/current.json?key=${apiKey}&q=${city}&aqi=no`, {
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (response.ok) {
                    const data = await response.json();
                    displayWeatherApiData(data);
                } else {
                    console.log('Weather API response not ok for city:', response.status);
                    // Keep fallback weather that's already displayed
                }
            } catch (error) {
                console.log('Weather API error for city:', error.message);
                // Keep fallback weather that's already displayed
            }
        }
        
        function displayWeatherApiData(data) {
            const temp = Math.round(data.current.temp_c);
            const desc = data.current.condition.text.toLowerCase();
            const locationName = `${data.location.name}, ${data.location.country}`;
            
            document.getElementById('weatherTemp').textContent = `${temp}¬∞C`;
            document.getElementById('weatherDesc').textContent = desc;
            document.getElementById('weatherLocation').textContent = locationName;
            
            const weatherIcon = getWeatherIconFromDesc(desc);
            document.getElementById('weatherIcon').textContent = weatherIcon;
            
            const advice = getGardenAdviceFromTemp(temp, desc);
            document.getElementById('gardenAdvice').innerHTML = `<small>${advice}</small>`;
        }
        
        function showSmartFallbackWeather() {
            // Show realistic weather based on current season
            const now = new Date();
            const month = now.getMonth();
            let temp, desc, icon, advice;
            
            if (month >= 2 && month <= 4) { // Spring
                temp = '18¬∞C'; desc = 'partly cloudy'; icon = '‚õÖ'; advice = 'Great weather for planting! üå±';
            } else if (month >= 5 && month <= 7) { // Summer
                temp = '25¬∞C'; desc = 'sunny'; icon = '‚òÄÔ∏è'; advice = 'Perfect day for gardening! Remember to water! üíß';
            } else if (month >= 8 && month <= 10) { // Autumn
                temp = '15¬∞C'; desc = 'cloudy'; icon = '‚òÅÔ∏è'; advice = 'Good time for harvesting! üçÇ';
            } else { // Winter
                temp = '8¬∞C'; desc = 'overcast'; icon = '‚òÅÔ∏è'; advice = 'Indoor gardening season! üè†';
            }
            
            document.getElementById('weatherTemp').textContent = temp;
            document.getElementById('weatherDesc').textContent = desc;
            document.getElementById('weatherLocation').textContent = 'London, UK';
            document.getElementById('weatherIcon').textContent = icon;
            document.getElementById('gardenAdvice').innerHTML = `<small>${advice}</small>`;
        }

        function getWeatherIcon(weather) {
            const icons = {
                'Clear': '‚òÄÔ∏è',
                'Clouds': '‚òÅÔ∏è',
                'Rain': 'üåßÔ∏è',
                'Snow': '‚ùÑÔ∏è',
                'Thunderstorm': '‚õàÔ∏è',
                'Drizzle': 'üå¶Ô∏è',
                'Mist': 'üå´Ô∏è'
            };
            return icons[weather] || 'üå§Ô∏è';
        }

        function getWeatherIconFromDesc(desc) {
            if (desc.includes('sunny') || desc.includes('clear')) return '‚òÄÔ∏è';
            if (desc.includes('rain')) return 'üåßÔ∏è';
            if (desc.includes('snow')) return '‚ùÑÔ∏è';
            if (desc.includes('cloud')) return '‚òÅÔ∏è';
            if (desc.includes('thunder')) return '‚õàÔ∏è';
            return '‚õÖ';
        }
        
        function getGardenAdviceFromTemp(temp, desc) {
            if (desc.includes('rain')) return 'Great day to skip watering! üåßÔ∏è';
            if (temp > 30) return 'Hot day - water plants early morning! ‚òÄÔ∏è';
            if (temp < 5) return 'Protect plants from frost! ‚ùÑÔ∏è';
            if (desc.includes('sunny') && temp > 20) return 'Perfect day for gardening! üå±';
            return 'Good conditions for plant care! üåø';
        }

        async function loadCareReminders(user) {
            try {
                const { doc, getDoc } = await import('https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js');
                
                const gardenDoc = await getDoc(doc(window.db, 'gardens', user.uid));
                const plants = gardenDoc.exists() ? (gardenDoc.data().plants || []) : [];
                
                const remindersContainer = document.getElementById('careReminders');
                remindersContainer.innerHTML = '';
                
                if (plants.length === 0) {
                    remindersContainer.innerHTML = '<p class="text-muted">Add plants to see care reminders</p>';
                    return;
                }
                
                plants.slice(0, 3).forEach((plant, index) => {
                    const reminder = createReminderItem(plant, index);
                    remindersContainer.appendChild(reminder);
                });
                
            } catch (error) {
                console.error('Error loading care reminders:', error);
            }
        }

        function createReminderItem(plant, index) {
            const div = document.createElement('div');
            div.className = 'reminder-item';
            
            const tasks = ['üíß Water', 'üå± Fertilize', '‚úÇÔ∏è Prune', 'üîç Check'];
            const times = ['2 hours', '1 day', '3 days', '1 week'];
            
            div.innerHTML = `
                <div class="reminder-icon">${tasks[index % tasks.length].split(' ')[0]}</div>
                <div class="reminder-content">
                    <div class="reminder-title">${tasks[index % tasks.length]} your ${plant.name}</div>
                    <div class="reminder-time">Due in ${times[index % times.length]}</div>
                </div>
                <button class="btn btn-sm btn-success" onclick="markReminderDone(this)">Done</button>
            `;
            
            return div;
        }

        function markReminderDone(button) {
            const reminderItem = button.closest('.reminder-item');
            reminderItem.style.opacity = '0.5';
            button.textContent = '‚úì';
            button.disabled = true;
            
            setTimeout(() => {
                reminderItem.remove();
            }, 1000);
        }

        async function loadGrowthProgress(user) {
            try {
                const { doc, getDoc } = await import('https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js');
                
                const gardenDoc = await getDoc(doc(window.db, 'gardens', user.uid));
                const plants = gardenDoc.exists() ? (gardenDoc.data().plants || []) : [];
                
                const progressContainer = document.getElementById('growthProgress');
                progressContainer.innerHTML = '';
                
                if (plants.length === 0) {
                    progressContainer.innerHTML = '<p class="text-muted">Add plants to track growth progress</p>';
                    return;
                }
                
                plants.slice(0, 4).forEach((plant, index) => {
                    const progressItem = createProgressItem(plant, index);
                    progressContainer.appendChild(progressItem);
                });
                
            } catch (error) {
                console.error('Error loading growth progress:', error);
            }
        }

        function createProgressItem(plant, index) {
            const div = document.createElement('div');
            div.className = 'progress-item';
            
            const progress = Math.min(100, 20 + (index * 25) + Math.random() * 30);
            const stage = getGrowthStage(progress);
            
            div.innerHTML = `
                <div class="progress-header">
                    <span class="progress-plant">${plant.name}</span>
                    <span class="progress-stage">${stage.emoji} ${stage.name}</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" style="width: ${progress}%"></div>
                </div>
                <div class="progress-text">${Math.round(progress)}% to maturity</div>
            `;
            
            return div;
        }

        function getGrowthStage(progress) {
            if (progress < 25) return { name: 'Seedling', emoji: 'üå±' };
            if (progress < 50) return { name: 'Growing', emoji: 'üåø' };
            if (progress < 75) return { name: 'Developing', emoji: 'üçÉ' };
            if (progress < 90) return { name: 'Flowering', emoji: 'üå∏' };
            return { name: 'Ready to Harvest', emoji: 'üçÖ' };
        }

        async function loadAchievements(user) {
            try {
                const { doc, getDoc, collection, query, getDocs } = await import('https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js');
                
                const gardenDoc = await getDoc(doc(window.db, 'gardens', user.uid));
                const plants = gardenDoc.exists() ? (gardenDoc.data().plants || []) : [];
                
                const journalQuery = query(collection(window.db, 'journal', user.uid, 'entries'));
                const journalSnapshot = await getDocs(journalQuery);
                
                const achievements = calculateAchievements(plants.length, journalSnapshot.size);
                
                const achievementsContainer = document.getElementById('achievements');
                achievementsContainer.innerHTML = '';
                
                achievements.forEach(achievement => {
                    const badge = createAchievementBadge(achievement);
                    achievementsContainer.appendChild(badge);
                });
                
            } catch (error) {
                console.error('Error loading achievements:', error);
            }
        }

        function calculateAchievements(plantCount, journalCount) {
            const achievements = [
                { id: 'first_plant', name: 'First Plant', emoji: 'üå±', description: 'Added your first plant', unlocked: plantCount >= 1 },
                { id: 'green_thumb', name: 'Green Thumb', emoji: 'üëç', description: 'Growing 5 plants', unlocked: plantCount >= 5 },
                { id: 'garden_master', name: 'Garden Master', emoji: 'üèÜ', description: 'Growing 10 plants', unlocked: plantCount >= 10 },
                { id: 'journal_keeper', name: 'Journal Keeper', emoji: 'üìñ', description: 'Made 10 journal entries', unlocked: journalCount >= 10 },
                { id: 'dedicated_gardener', name: 'Dedicated Gardener', emoji: '‚≠ê', description: '30-day streak', unlocked: journalCount >= 30 },
                { id: 'harvest_time', name: 'First Harvest', emoji: 'üçÖ', description: 'Harvested your first crop', unlocked: plantCount >= 3 }
            ];
            
            return achievements;
        }

        function createAchievementBadge(achievement) {
            const div = document.createElement('div');
            div.className = `achievement-badge ${achievement.unlocked ? 'unlocked' : 'locked'}`;
            
            div.innerHTML = `
                <div class="achievement-emoji">${achievement.emoji}</div>
                <div class="achievement-name">${achievement.name}</div>
                <div class="achievement-desc">${achievement.description}</div>
            `;
            
            return div;
        }

        // AI features are loaded from separate files
    </script>
</head>
<body>
    <div class="app-container">
        <!-- Desktop Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>üå± Urban Garden</h2>
            </div>
            
            <ul class="sidebar-nav">
                <li><a href="index.html" class="nav-link active"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="library.html" class="nav-link"><i class="fas fa-leaf"></i> Plant Library</a></li>
                <li><a href="garden.html" class="nav-link"><i class="fas fa-seedling"></i> My Garden</a></li>
                <li><a href="tasks.html" class="nav-link"><i class="fas fa-tasks"></i> Tasks</a></li>
                <li><a href="community.html" class="nav-link"><i class="fas fa-users"></i> Community</a></li>
                <li><a href="journal.html" class="nav-link"><i class="fas fa-book"></i> Journal</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header">
                <h1>Welcome to Your Garden! üåø</h1>
                <p>Your urban gardening journey starts here.</p>
            </div>
            
            <!-- Weather & Profile Row -->
            <div class="dashboard-row">
                <!-- Weather Widget -->
                <div class="card weather-card">
                    <div class="card-body">
                        <div class="weather-widget">
                            <div class="weather-icon" id="weatherIcon">‚òÄÔ∏è</div>
                            <div class="weather-info">
                                <div class="weather-temp" id="weatherTemp">--¬∞</div>
                                <div class="weather-desc" id="weatherDesc">Loading...</div>
                                <div class="weather-location" id="weatherLocation">--</div>
                            </div>
                            <div class="garden-advice" id="gardenAdvice">
                                <small>Perfect day for gardening! üå±</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Card -->
                <div class="card profile-card-compact">
                    <div class="card-body">
                        <div class="profile-card">
                            <div class="profile-avatar" id="profileAvatar">
                                <span id="profilePlaceholder">üë§</span>
                                <img id="profileImage" style="display: none;">
                            </div>
                            <div class="profile-info">
                                <h3 id="profileName">Loading...</h3>
                                <p id="profileEmail">Loading...</p>
                                <div class="profile-status">üå± Garden Enthusiast</div>
                            </div>
                            <a href="profile.html" class="btn btn-secondary">
                                <i class="fas fa-edit"></i> Edit Profile
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card green">
                    <div class="stat-number" id="plantCount">0</div>
                    <div class="stat-label">Plants</div>
                </div>
                <div class="stat-card yellow">
                    <div class="stat-number" id="taskCount">0</div>
                    <div class="stat-label">Tasks</div>
                </div>
                <div class="stat-card purple">
                    <div class="stat-number" id="journalCount">0</div>
                    <div class="stat-label">Entries</div>
                </div>
                <div class="stat-card blue">
                    <div class="stat-number" id="pointsCount">0</div>
                    <div class="stat-label">Points</div>
                </div>
            </div>
            
            <!-- AI Personalized Daily Tips -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ü§ñ AI Daily Garden Tips</h2>
                    <button class="btn btn-sm btn-secondary" onclick="generateDailyTips()">Refresh Tips</button>
                </div>
                <div class="card-body">
                    <div id="aiDailyTips" class="ai-tips">
                        <div class="loading-tip">üå± Generating personalized tips...</div>
                    </div>
                </div>
            </div>

            <!-- Plant Care Reminders -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üîî Today's Care Reminders</h2>
                </div>
                <div class="card-body">
                    <div id="careReminders" class="care-reminders">
                        <div class="reminder-item">
                            <div class="reminder-icon">üíß</div>
                            <div class="reminder-content">
                                <div class="reminder-title">Water your Basil</div>
                                <div class="reminder-time">Due in 2 hours</div>
                            </div>
                            <button class="btn btn-sm btn-success">Done</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Growth Progress -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìà Plant Growth Progress</h2>
                </div>
                <div class="card-body">
                    <div id="growthProgress" class="growth-progress">
                        <!-- Progress items will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- AI Smart Analysis -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìä AI Garden Analysis</h2>
                    <button class="btn btn-sm btn-secondary" onclick="runGardenAnalysis()">Analyze Garden</button>
                </div>
                <div class="card-body">
                    <div id="gardenAnalysis" class="analysis-grid">
                        <div class="analysis-item">
                            <div class="analysis-icon">üå±</div>
                            <div class="analysis-content">
                                <div class="analysis-title">Garden Health</div>
                                <div class="analysis-result" id="healthAnalysis">Analyzing...</div>
                            </div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-icon">üìÖ</div>
                            <div class="analysis-content">
                                <div class="analysis-title">Harvest Predictions</div>
                                <div class="analysis-result" id="harvestPredictions">Calculating...</div>
                            </div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-icon">üêõ</div>
                            <div class="analysis-content">
                                <div class="analysis-title">Pest/Disease Risk</div>
                                <div class="analysis-result" id="pestAnalysis">Checking...</div>
                            </div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-icon">üåø</div>
                            <div class="analysis-content">
                                <div class="analysis-title">Planting Suggestions</div>
                                <div class="analysis-result" id="plantingSuggestions">Generating...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Achievements -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üèÜ Achievements</h2>
                </div>
                <div class="card-body">
                    <div id="achievements" class="achievements-grid">
                        <!-- Achievement badges will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="action-buttons">
                <a href="library.html" class="btn btn-primary">
                    <i class="fas fa-leaf"></i> Browse Plants
                </a>
                <a href="garden.html" class="btn btn-primary">
                    <i class="fas fa-seedling"></i> My Garden
                </a>
                <a href="tasks.html" class="btn btn-primary">
                    <i class="fas fa-tasks"></i> View Tasks
                </a>
            </div>
            
            <!-- Seasonal Tips -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üçÇ Seasonal Tips</h2>
                </div>
                <div class="card-body">
                    <div class="tips-grid">
                        <div class="tip-card" style="background: linear-gradient(135deg, #fbbf24, #f59e0b);">
                            <div class="tip-icon">üçÇ</div>
                            <h3>Autumn Planting</h3>
                            <p>Perfect time to plant cool-season crops like lettuce, spinach, and radishes.</p>
                        </div>
                        
                        <div class="tip-card" style="background: linear-gradient(135deg, #10b981, #059669);">
                            <div class="tip-icon">üíß</div>
                            <h3>Watering Tips</h3>
                            <p>Reduce watering frequency as temperatures drop. Check soil moisture first.</p>
                        </div>
                        
                        <div class="tip-card" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                            <div class="tip-icon">üå±</div>
                            <h3>Indoor Growing</h3>
                            <p>Start herbs indoors for fresh cooking ingredients all winter long.</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Mobile Navigation -->
        <nav class="mobile-nav">
            <div class="mobile-nav-grid">
                <a href="index.html" class="mobile-nav-item active">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="library.html" class="mobile-nav-item">
                    <i class="fas fa-leaf"></i>
                    <span>Library</span>
                </a>
                <a href="garden.html" class="mobile-nav-item">
                    <i class="fas fa-seedling"></i>
                    <span>Garden</span>
                </a>
                <a href="tasks.html" class="mobile-nav-item">
                    <i class="fas fa-tasks"></i>
                    <span>Tasks</span>
                </a>
                <a href="community.html" class="mobile-nav-item">
                    <i class="fas fa-users"></i>
                    <span>Community</span>
                </a>
                <a href="journal.html" class="mobile-nav-item">
                    <i class="fas fa-book"></i>
                    <span>Journal</span>
                </a>
            </div>
        </nav>

        <!-- Floating Chat Button -->
        <div class="floating-chat-btn" id="floatingChatBtn" onclick="toggleFloatingChat()">
            <i class="fas fa-robot"></i>
        </div>

        <!-- Floating Chat Widget -->
        <div id="floatingChatWidget" class="floating-chat-widget">
            <div class="chat-header">
                <div class="chat-title">
                    <i class="fas fa-robot"></i>
                    <span>AI Garden Assistant</span>
                </div>
                <button class="chat-close" onclick="closeFloatingChat()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="chat-body">
                <div class="chat-messages" id="chatMessages">
                    <div class="chat-message ai-message">
                        <div class="message-avatar">ü§ñ</div>
                        <div class="message-content">
                            <div class="message-text">Hi! I'm your AI Garden Assistant. Ask me anything about gardening! üå±</div>
                        </div>
                    </div>
                </div>
                <div class="chat-input-container">
                    <input type="text" id="chatInput" placeholder="Ask about your plants..." onkeypress="handleChatKeyPress(event)">
                    <button onclick="sendChatMessage()" class="chat-send-btn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Analysis Detail Modal -->
        <div id="analysisModal" class="analysis-modal">
            <div class="modal-content">
                <button class="modal-close" onclick="closeAnalysisModal()">&times;</button>
                <div class="modal-header">
                    <div class="modal-icon" id="modalIcon">üå±</div>
                    <h2 id="modalTitle">Garden Health</h2>
                </div>
                <div class="modal-body">
                    <div id="modalContent">Loading detailed analysis...</div>
                </div>
            </div>
        </div>


    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="script-simple.js"></script>
    
    <!-- AI Features -->
    <script src="ai/gemini-api.js"></script>
    <script src="ai/daily-tips.js"></script>
    <script src="ai/garden-analysis.js"></script>
    <script src="ai/chat-assistant.js"></script>
    <link rel="stylesheet" href="ai/ai-styles.css">
    
    <script>
        // Floating Chat Functions
        function toggleFloatingChat() {
            const widget = document.getElementById('floatingChatWidget');
            const btn = document.getElementById('floatingChatBtn');
            
            if (widget.classList.contains('active')) {
                closeFloatingChat();
            } else {
                widget.classList.add('active');
                btn.style.display = 'none';
                
                // Focus input after animation
                setTimeout(() => {
                    const input = document.getElementById('chatInput');
                    if (input) input.focus();
                }, 300);
            }
        }
        
        function closeFloatingChat() {
            const widget = document.getElementById('floatingChatWidget');
            const btn = document.getElementById('floatingChatBtn');
            
            widget.classList.remove('active');
            btn.style.display = 'flex';
        }
        
        // Override chat functions for floating widget
        function handleChatKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendChatMessage();
            }
        }
    </script>
</body>
</html>
